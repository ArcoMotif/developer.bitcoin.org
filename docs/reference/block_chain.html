

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Block Chain &mdash; Bitcoin  documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transactions" href="transactions.html" />
    <link rel="prev" title="Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >
          

          
            <a href="../index.html">
          

          
            
            <img src="../_static/bitcoin-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../devguide/index.html">Developer Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Block Chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#block-headers">Block Headers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#block-versions">Block Versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#merkle-trees">Merkle Trees</a></li>
<li class="toctree-l4"><a class="reference internal" href="#target-nbits">Target nBits</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#serialized-blocks">Serialized Blocks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transactions</a></li>
<li class="toctree-l2"><a class="reference internal" href="wallets.html">Wallets</a></li>
<li class="toctree-l2"><a class="reference internal" href="p2p_networking.html">P2P Network</a></li>
<li class="toctree-l2"><a class="reference internal" href="rpc/index.html">RPC API Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bitcoin</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Reference</a> &raquo;</li>
        
      <li>Block Chain</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/cornelius/bitcoin-dev-docs/blob/master/reference/block_chain.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="block-chain">
<h1>Block Chain<a class="headerlink" href="#block-chain" title="Permalink to this headline">¶</a></h1>
<p>The following subsections briefly document core block details.</p>
<div class="section" id="block-headers">
<h2>Block Headers<a class="headerlink" href="#block-headers" title="Permalink to this headline">¶</a></h2>
<p>Block headers are serialized in the 80-byte format described below and then hashed as part of Bitcoin’s proof-of-work algorithm, making the serialized header format part of the consensus rules.</p>
<table border="1" class="docutils">
<colgroup>
<col width="2%" />
<col width="21%" />
<col width="3%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Bytes</th>
<th class="head">Name</th>
<th class="head">Data Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>4</td>
<td>version</td>
<td>int32_t</td>
<td>The <a class="reference external" href="../reference/glossary.html#block">block version</a> number indicates which set of block validation rules to follow. See the list of block versions below.</td>
</tr>
<tr class="row-odd"><td>32</td>
<td><a class="reference external" href="/en/developer-reference#term-previous-block-header-hash">previous block header hash</a></td>
<td>char[32]</td>
<td>A SHA256(SHA256()) hash in internal byte order of the previous block’s header. This ensures no previous block can be changed without also changing this block’s header.</td>
</tr>
<tr class="row-even"><td>32</td>
<td>merkle root hash</td>
<td>char[32]</td>
<td>A SHA256(SHA256()) hash in internal byte order. The merkle root is derived from the hashes of all transactions included in this block, ensuring that none of those transactions can be modified without modifying the header. See the <a class="reference external" href="/en/developer-reference#merkle-trees">merkle trees section</a> below.</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>time</td>
<td>uint32_t</td>
<td>The block time is a <a class="reference external" href="https://en.wikipedia.org/wiki/Unix_time">Unix epoch time</a> when the miner started hashing the header (according to the miner). Must be strictly greater than the median time of the previous 11 blocks. Full nodes will not accept blocks with headers more than two hours in the future according to their clock.</td>
</tr>
<tr class="row-even"><td>4</td>
<td>nBits</td>
<td>uint32_t</td>
<td>An encoded version of the target threshold this block’s header hash must be less than or equal to. See the nBits format described below.</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>nonce</td>
<td>uint32_t</td>
<td>An arbitrary number miners change to modify the header hash in order to produce a hash less than or equal to the target threshold. If all 32-bit values are tested, the time can be updated or the coinbase transaction can be changed and the merkle root updated.</td>
</tr>
</tbody>
</table>
<p>The hashes are in internal byte order; the other values are all in little-endian order.</p>
<p>An example header in hex:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>02000000 ........................... Block version: 2

b6ff0b1b1680a2862a30ca44d346d9e8
910d334beb48ca0c0000000000000000 ... Hash of previous block&#39;s header
9d10aa52ee949386ca9385695f04ede2
70dda20810decd12bc9b048aaab31471 ... Merkle root

24d95a54 ........................... [Unix time][unix epoch time]: 1415239972
30c31b18 ........................... Target: 0x1bc330 * 256**(0x18-3)
fe9f0864 ........................... Nonce
</pre></div>
</div>
<div class="section" id="block-versions">
<h3>Block Versions<a class="headerlink" href="#block-versions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Version 1</strong> was introduced in the genesis block (January 2009).</li>
<li><a class="reference external" href="/en/developer-reference#term-v2-block">Version 2</a> was introduced in <a class="reference external" href="/en/release/v0.7.0">Bitcoin Core 0.7.0</a> (September 2012) as a soft fork. As described in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP34</a>, valid <a class="reference external" href="/en/developer-reference#term-v2-block">version 2 blocks</a> require a <a class="reference external" href="/en/developer-reference#term-coinbase-block-height">block height parameter in the coinbase</a>. Also described in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP34</a> are rules for rejecting certain blocks; based on those rules, <a class="reference external" href="/en/release/v0.7.0">Bitcoin Core 0.7.0</a> and later versions began to reject <a class="reference external" href="/en/developer-reference#term-v2-block">version 2 blocks</a> without the block height in coinbase at block height 224,412 (March 2013) and began to reject new version 1 blocks three weeks later at block height 227,930.</li>
<li><strong>Version 3</strong> blocks were introduced in <a class="reference external" href="/en/release/v0.10.0">Bitcoin Core 0.10.0</a> (February<ol class="arabic" start="2015">
<li>as a soft fork. When the fork reached full enforcement (July 2015), it required strict <a class="reference external" href="https://en.wikipedia.org/wiki/X.690#DER_encoding">DER</a> encoding of all <a class="reference external" href="https://en.wikipedia.org/wiki/Elliptic_Curve_DSA">ECDSA</a> signatures in new blocks as described in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP66</a>. Transactions that do not use strict <a class="reference external" href="https://en.wikipedia.org/wiki/X.690#DER_encoding">DER</a> encoding had previously been non-standard since <a class="reference external" href="/en/release/v0.8.0">Bitcoin Core 0.8.0</a> (February 2012).</li>
</ol>
</li>
<li><strong>Version 4</strong> blocks specified in BIP65 and introduced in <a class="reference external" href="/en/release/v0.11.2">Bitcoin Core 0.11.2</a> (November 2015) as a soft fork became active in December 2015. These blocks now support the new <code class="docutils literal notranslate"><span class="pre">OP_CHECKLOCKTIMEVERIFY</span></code> opcode described in that BIP.</li>
</ul>
<p>The mechanism used for the version 2, 3, and 4 upgrades is commonly called IsSuperMajority() after the function added to Bitcoin Core to manage those soft forking changes. See <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP34</a> for a full description of this method.</p>
<p>As of this writing, a newer method called <em>version bits</em> is being designed to manage future soft forking changes, although it’s not known whether version 4 will be the last soft fork to use the IsSuperMajority() function. Draft <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP9</a> describes the version bits design as of this writing, although it is still being actively edited and may substantially change while in the draft state.</p>
</div>
<div class="section" id="merkle-trees">
<h3>Merkle Trees<a class="headerlink" href="#merkle-trees" title="Permalink to this headline">¶</a></h3>
<p>The merkle root is constructed using all the TXIDs of transactions in this block, but first the TXIDs are placed in order as required by the consensus rules:</p>
<ul class="simple">
<li>The coinbase transaction’s TXID is always placed first.</li>
<li>Any input within this block can spend an output which also appears in this block (assuming the spend is otherwise valid). However, the TXID corresponding to the output must be placed at some point before the TXID corresponding to the input. This ensures that any program parsing block chain transactions linearly will encounter each output before it is used as an input.</li>
</ul>
<p>If a block only has a coinbase transaction, the coinbase TXID is used as the merkle root hash.</p>
<p>If a block only has a coinbase transaction and one other transaction, the TXIDs of those two transactions are placed in order, concatenated as 64 raw bytes, and then SHA256(SHA256()) hashed together to form the merkle root.</p>
<p>If a block has three or more transactions, intermediate merkle tree rows are formed. The TXIDs are placed in order and paired, starting with the coinbase transaction’s TXID. Each pair is concatenated together as 64 raw bytes and SHA256(SHA256()) hashed to form a second row of hashes. If there are an odd (non-even) number of TXIDs, the last TXID is concatenated with a copy of itself and hashed. If there are more than two hashes in the second row, the process is repeated to create a third row (and, if necessary, repeated further to create additional rows). Once a row is obtained with only two hashes, those hashes are concatenated and hashed to produce the merkle root.</p>
<div class="figure" id="id1">
<img alt="Example Merkle Tree Construction" src="../_images/en-merkle-tree-construction.svg" /><p class="caption"><span class="caption-text">Example Merkle Tree Construction</span></p>
</div>
<p>TXIDs and intermediate hashes are always in internal byte order when they’re concatenated, and the resulting merkle root is also in internal byte order when it’s placed in the block header.</p>
</div>
<div class="section" id="target-nbits">
<h3>Target nBits<a class="headerlink" href="#target-nbits" title="Permalink to this headline">¶</a></h3>
<p>The target threshold is a 256-bit unsigned integer which a header hash must be equal to or below in order for that header to be a valid part of the block chain. However, the header field <em>nBits</em> provides only 32 bits of space, so the target number uses a less precise format called “compact” which works like a base-256 version of scientific notation:</p>
<div class="figure" id="id2">
<img alt="Converting nBits Into A Target Threshold" src="../_images/en-nbits-overview.svg" /><p class="caption"><span class="caption-text">Converting nBits Into A Target Threshold</span></p>
</div>
<p>As a base-256 number, nBits can be quickly parsed as bytes the same way you might parse a decimal number in base-10 scientific notation:</p>
<div class="figure" id="id3">
<img alt="Quickly Converting nBits" src="../_images/en-nbits-quick-parse.svg" /><p class="caption"><span class="caption-text">Quickly Converting nBits</span></p>
</div>
<p>Although the target threshold should be an unsigned integer, the original nBits implementation inherits properties from a signed data class, allowing the target threshold to be negative if the high bit of the significand is set. This is useless—the header hash is treated as an unsigned number, so it can never be equal to or lower than a negative target threshold. Bitcoin Core deals with this in two ways:</p>
<ul class="simple">
<li>When parsing nBits, Bitcoin Core converts a negative target threshold into a target of zero, which the header hash can equal (in theory, at least).</li>
<li>When creating a value for nBits, Bitcoin Core checks to see if it will produce an nBits which will be interpreted as negative; if so, it divides the significand by 256 and increases the exponent by 1 to produce the same number with a different encoding.</li>
</ul>
<p>Some examples taken from the Bitcoin Core test cases:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="23%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">nBits</th>
<th class="head">Target</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0x01003456</td>
<td>0x00</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>0x01123456</td>
<td>0x12</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>0x02008000</td>
<td>0x80</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>0x05009234</td>
<td>0x92340000</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>0x04923456</td>
<td>-0x12345600</td>
<td>High bit set (0x80 in 0x92).</td>
</tr>
<tr class="row-odd"><td>0x04123456</td>
<td>0x12345600</td>
<td>Inverse of above; no high bit.</td>
</tr>
</tbody>
</table>
<p>Difficulty 1, the minimum allowed difficulty, is represented on mainnet and the current testnet by the nBits value 0x1d00ffff. Regtest mode uses a different difficulty 1 value—0x207fffff, the highest possible value below uint32_max which can be encoded; this allows near-instant building of blocks in regtest mode.</p>
</div>
</div>
<div class="section" id="serialized-blocks">
<h2>Serialized Blocks<a class="headerlink" href="#serialized-blocks" title="Permalink to this headline">¶</a></h2>
<p>Under current consensus rules, a block is not valid unless its serialized size is less than or equal to 1 MB. All fields described below are counted towards the serialized size.</p>
<div class="line-block">
<div class="line">Bytes | Name | Data Type | Description</div>
<div class="line">80 | block header | block_header | The block header in the format described in the <a class="reference external" href="/en/developer-reference#block-headers">block header section</a>.</div>
<div class="line"><em>Varies</em> | txn_count | compactSize uint | The total number of transactions in this block, including the coinbase transaction.</div>
<div class="line"><em>Varies</em> | txns | raw transaction | Every transaction in this block, one after another, in raw transaction format. Transactions must appear in the data stream in the same order their TXIDs appeared in the first row of the merkle tree. See the <a class="reference external" href="/en/developer-reference#merkle-trees">merkle tree section</a> for details.</div>
</div>
<p>The first transaction in a block must be a <a class="reference external" href="../reference/glossary.html#coinbase-transaction">coinbase transaction</a> which should collect and spend any transaction fees paid by transactions included in this block.</p>
<p>All blocks with a block height less than 6,930,000 are entitled to receive a block subsidy of newly created bitcoin value, which also should be spent in the coinbase transaction. (The block subsidy started at 50 bitcoins and is being halved every 210,000 blocks—approximately once every four years. As of November 2017, it’s 12.5 bitcoins.)</p>
<p>Together, the transaction fees and block subsidy are called the <a class="reference external" href="../reference/glossary.html#block-reward">block reward</a>. A coinbase transaction is invalid if it tries to spend more value than is available from the block reward.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="transactions.html" class="btn btn-neutral float-right" title="Transactions" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="intro.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Bitcoin.org

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>